<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FunLessons ‚Äì Happy Kids Flashcards (Orange Ultra)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<style>
/* --- ESTILOS VISUALES "KIDS ORANGE" --- */
:root {
    --primary: #ffcc80; /* Naranja claro alegre e infantil */
    --primary-dark: #ef6c00;
    --secondary: #4fc3f7; 
    --bg-gradient: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
    --color-img-mode: #ffa726; 
    --color-word-mode: #5c6bc0;
    --color-exam-mode: #c5e1a5;
    --color-success: #81c784; 
    --color-error: #e57373;
    --card-bg-word: #5c6bc0;
}

body {
    margin: 0; font-family: "Comic Sans MS", "Segoe UI", sans-serif;
    background: var(--bg-gradient); min-height: 100vh;
    padding: 10px; display: flex; flex-direction: column; align-items: center;
}

.app {
    width: 100%; max-width: 500px;
    background: #ffffff; border-radius: 45px;
    box-shadow: 0 20px 0px rgba(239, 108, 0, 0.2), 0 25px 50px rgba(0,0,0,0.1); 
    overflow: hidden; display: flex; flex-direction: column;
    border: 5px solid var(--primary);
}

header { 
    background: var(--primary); color: #e65100; padding: 20px; 
    text-align: center; display: flex; justify-content: center; 
    align-items: center; gap: 12px; font-weight: 900; font-size: 1.3rem;
    text-shadow: 1px 1px 0px rgba(255,255,255,0.5);
}
header img { width: 35px; border-radius: 50%; border: 3px solid #fff; }

.exam-bar { 
    background: #333; color: white; padding: 10px 20px; 
    display: none; justify-content: space-between; align-items: center; 
    font-size: 0.9rem; font-weight: bold;
}

.progress-container { width: 100%; height: 10px; background: #fff3e0; }
.progress-bar { width: 0%; height: 100%; background: var(--primary-dark); transition: width 0.4s; }

/* PESTA√ëAS DE MODO */
.mode-selector { display: flex; padding: 12px; gap: 10px; background: #fff; }
.mode-btn { 
    flex: 1; padding: 12px; border: 3px solid #fff3e0; border-radius: 20px; 
    background: #fff; color: #999; font-weight: 800; cursor: pointer; 
    display: flex; align-items: center; justify-content: center; gap: 6px; 
    transition: all 0.2s; font-size: 0.75rem;
}
.mode-btn.active.img-en { background: var(--color-img-mode); color: white; border-color: #fb8c00; transform: translateY(-3px); }
.mode-btn.active.en-img { background: var(--color-word-mode); color: white; border-color: #3f51b5; transform: translateY(-3px); }
.mode-btn.exam.active { background: var(--color-exam-mode); color: white; border-color: #8bc34a; transform: translateY(-3px); }

/* Estilo de iconos en recuadro blanco circular */
.icon-btn-img { 
    width: 28px; 
    height: 28px; 
    border-radius: 50%; 
    border: 2px solid #fff; 
    background: #fff; 
    vertical-align: middle; 
    object-fit: contain; 
}

.controls-top { padding: 10px 20px; text-align: center; }
select { 
    padding: 12px; border-radius: 25px; border: 3px solid var(--primary-dark); 
    font-weight: 800; width: 100%; cursor: pointer; color: #e65100; background: #fff3e0;
    font-size: 1rem;
}

.mix-panel { 
    display: none; background: #fff3e0; padding: 20px; margin: 0 15px 15px 15px; 
    border-radius: 25px; text-align: left; max-height: 200px; overflow-y: auto; 
    border: 3px dashed var(--primary-dark);
}

/* CARTA DE JUEGO */
.scene { width: 100%; height: 360px; perspective: 1000px; display: flex; justify-content: center; align-items: center; }
.card { width: 300px; height: 300px; position: relative; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; cursor: pointer; }
.card.is-flipped { transform: rotateY(180deg); }
.card-face { 
    position: absolute; width: 100%; height: 100%; backface-visibility: hidden; 
    border-radius: 45px; display: flex; flex-direction: column; align-items: center; 
    justify-content: center; padding: 25px; box-sizing: border-box; border: 10px solid #fff; 
    box-shadow: 0 15px 30px rgba(0,0,0,0.06); 
}
.face-img { background: #e1f5fe; }
.face-word { background: var(--card-bg-word); color: white; }
.card-face.back { transform: rotateY(180deg); }

.main-img { width: 100%; height: 180px; display: flex; align-items: center; justify-content: center; font-size: 8.5rem; }
.main-img img { max-width: 95%; max-height: 95%; object-fit: contain; }
.main-text { font-size: 2.3rem; font-weight: 900; text-transform: uppercase; text-align: center; line-height: 1; }
.flag-label { width: 45px; height: 45px; margin-bottom: 15px; border-radius: 50%; border: 4px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

.exam-actions { display: none; gap: 30px; margin-top: 20px; }
.action-btn { border: none; border-radius: 50%; width: 65px; height: 65px; color: white; font-size: 2rem; cursor: pointer; box-shadow: 0 8px 15px rgba(0,0,0,0.15); transition: transform 0.1s; }
.action-btn:active { transform: scale(0.85); }
.btn-yes { background: var(--color-success); }
.btn-no { background: var(--color-error); }

.nav-controls { display: flex; justify-content: space-between; align-items: center; padding: 20px 40px; background: #fff; }
.nav-btn { 
    background: var(--primary); color: #e65100; border: none; width: 55px; height: 55px; 
    border-radius: 50%; font-size: 1.6rem; cursor: pointer; box-shadow: 0 6px 0px var(--primary-dark);
}
.nav-btn:active { transform: translateY(3px); box-shadow: 0 3px 0px var(--primary-dark); }
.nav-btn:disabled { background: #eee; box-shadow: none; opacity: 0.5; cursor: default; }
.counter { font-weight: 900; color: #ef6c00; font-size: 1.1rem; }

.sound-btn { background: rgba(255,255,255,0.3); border: 3px solid #fff; color: #fff; border-radius: 50%; width: 55px; height: 55px; cursor: pointer; font-size: 1.6rem; margin-top: 15px; }
</style>
</head>
<body>

<div class="app">
    <div class="exam-bar" id="examBar">
        <span>‚è±Ô∏è <span id="timer">00:00</span></span>
        <span>üî• <span id="streak">0</span></span>
        <span>‚úÖ <span id="scoreCorrect">0</span> | ‚ùå <span id="scoreWrong">0</span></span>
    </div>
    <div class="progress-container"><div id="progressBar" class="progress-bar"></div></div>

    <header>
        <img src="english.png"> PICTURE DICTIONARY 4 <img src="english.png">
    </header>

    <div class="mode-selector">
        <button id="btnImgEn" class="mode-btn active img-en" onclick="setMode('IMG-EN')">
            <img src="camera.png" class="icon-btn-img"> ‚ûî <img src="english.png" class="icon-btn-img">
        </button>
        <button id="btnEnImg" class="mode-btn en-img" onclick="setMode('EN-IMG')">
            <img src="english.png" class="icon-btn-img"> ‚ûî <img src="camera.png" class="icon-btn-img">
        </button>
        <button id="btnExam" class="mode-btn exam" onclick="toggleExamMode()">üéì EXAM</button>
    </div>

    <div class="controls-top">
        <select id="categorySelect" onchange="handleCategoryChange()">
            <option value="ALL">üåü All Topics</option>
            <option value="MIXED">üß© Mixed Topics</option>
        </select>
    </div>

    <div id="mixPanel" class="mix-panel">
        <strong>Choose your topics:</strong><hr>
        <div id="mixCheckboxes"></div>
        <button style="width:100%; margin-top:15px; background:var(--primary-dark); color:white; border:none; padding:10px; border-radius:15px; font-weight:bold; cursor:pointer;" onclick="changeCategory()">Start!</button>
    </div>

    <div class="scene">
        <div class="card" id="flashcard" onclick="flipCard()">
            <div class="card-face front" id="faceFront">
                <div class="main-img" id="imgFront"></div>
                <img id="flagFront" class="flag-label" src="english.png" style="display:none">
                <div class="main-text" id="textFront"></div>
            </div>
            <div class="card-face back" id="faceBack">
                <div class="main-img" id="imgBack"></div>
                <img id="flagBack" class="flag-label" src="english.png" style="display:none">
                <div class="main-text" id="textBack"></div>
                <div id="examActions" class="exam-actions">
                    <button class="action-btn btn-no" onclick="event.stopPropagation(); markResult(false)">‚ùå</button>
                    <button class="action-btn btn-yes" onclick="event.stopPropagation(); markResult(true)">‚úÖ</button>
                </div>
                <button id="soundBtn" class="sound-btn" onclick="event.stopPropagation(); playCurrentAudio()">üîä</button>
            </div>
        </div>
    </div>

    <div class="nav-controls">
        <button class="nav-btn" id="prevBtn" onclick="prevCard()">‚¨ÖÔ∏è</button>
        <div class="counter" id="counterDisplay">0 / 0</div>
        <button class="nav-btn" id="nextBtn" onclick="nextCard()">‚û°Ô∏è</button>
    </div>
</div>

<script>
/* --- VOCABULARIO COMPLETO  --- */
const vocab = [
    {en:"JANUARY", img:"january.png", isImage:true, cat:"CALENDAR", emoji:"üìÖ"}, {en:"FEBRUARY", img:"february.png", isImage:true, cat:"CALENDAR", emoji:"üìÖ"},
    {en:"MARCH", img:"march.png", isImage:true, cat:"CALENDAR", emoji:"üìÖ"}, {en:"APRIL", img:"april.png", isImage:true, cat:"CALENDAR", emoji:"üìÖ"},
    {en:"MAY", img:"may.png", isImage:true, cat:"CALENDAR", emoji:"üìÖ"}, {en:"JUNE", img:"june.png", isImage:true, cat:"CALENDAR", emoji:"üìÖ"},
    {en:"JULY", img:"july.png", isImage:true, cat:"CALENDAR", emoji:"üìÖ"}, {en:"AUGUST", img:"august.png", isImage:true, cat:"CALENDAR", emoji:"üìÖ"},
    {en:"SEPTEMBER", img:"september.png", isImage:true, cat:"CALENDAR", emoji:"üìÖ"}, {en:"OCTOBER", img:"october.png", isImage:true, cat:"CALENDAR", emoji:"üìÖ"},
    {en:"NOVEMBER", img:"november.png", isImage:true, cat:"CALENDAR", emoji:"üìÖ"}, {en:"DECEMBER", img:"december.png", isImage:true, cat:"CALENDAR", emoji:"üìÖ"},
    {en:"MONDAY", img:"monday.png", isImage:true, cat:"CALENDAR", emoji:"üìÖ"}, {en:"TUESDAY", img:"tuesday.png", isImage:true, cat:"CALENDAR", emoji:"üìÖ"},
    {en:"WEDNESDAY", img:"wednesday.png", isImage:true, cat:"CALENDAR", emoji:"üìÖ"}, {en:"THURSDAY", img:"thursday.png", isImage:true, cat:"CALENDAR", emoji:"üìÖ"},
    {en:"FRIDAY", img:"friday.png", isImage:true, cat:"CALENDAR", emoji:"üìÖ"}, {en:"SATURDAY", img:"saturday.png", isImage:true, cat:"CALENDAR", emoji:"üìÖ"},
    {en:"SUNDAY", img:"sunday.png", isImage:true, cat:"CALENDAR", emoji:"üìÖ"}, {en:"SPRING", img:"spring.png", isImage:true, cat:"CALENDAR", emoji:"üå∏"},
    {en:"SUMMER", img:"summer.png", isImage:true, cat:"CALENDAR", emoji:"‚òÄÔ∏è"}, {en:"AUTUMN", img:"autumn.png", isImage:true, cat:"CALENDAR", emoji:"üçÇ"},
    {en:"WINTER", img:"winter.png", isImage:true, cat:"CALENDAR", emoji:"‚ùÑÔ∏è"},

    {en:"ONE", img:"1Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"}, {en:"TWO", img:"2Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"}, {en:"THREE", img:"3Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"},
    {en:"FOUR", img:"4Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"}, {en:"FIVE", img:"5Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"}, {en:"SIX", img:"6Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"},
    {en:"SEVEN", img:"7Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"}, {en:"EIGHT", img:"8Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"}, {en:"NINE", img:"9Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"},
    {en:"TEN", img:"üîü", cat:"NUMBERS", emoji:"üî¢"}, {en:"TWELVE", img:"1Ô∏è‚É£2Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"}, {en:"THIRTEEN", img:"1Ô∏è‚É£3Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"},
    {en:"FOURTEEN", img:"1Ô∏è‚É£4Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"}, {en:"FIFTEEN", img:"1Ô∏è‚É£5Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"}, {en:"SIXTEEN", img:"1Ô∏è‚É£6Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"},
    {en:"EIGHTEEN", img:"1Ô∏è‚É£8Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"}, {en:"NINETEEN", img:"1Ô∏è‚É£9Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"}, {en:"TWENTY", img:"2Ô∏è‚É£0Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"},
    {en:"THIRTY", img:"3Ô∏è‚É£0Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"}, {en:"FORTY", img:"4Ô∏è‚É£0Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"}, {en:"FIFTY", img:"5Ô∏è‚É£0Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"},
    {en:"SIXTY", img:"6Ô∏è‚É£0Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"}, {en:"SEVENTY", img:"7Ô∏è‚É£0Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"}, {en:"EIGHTY", img:"8Ô∏è‚É£0Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"},
    {en:"NINETY", img:"9Ô∏è‚É£0Ô∏è‚É£", cat:"NUMBERS", emoji:"üî¢"}, {en:"ONE HUNDRED", img:"üíØ", cat:"NUMBERS", emoji:"üî¢"},

    {en:"BASKETBALL", img:"üèÄ", cat:"SPORTS", emoji:"‚öΩ"}, {en:"FOOTBALL", img:"‚öΩ", cat:"SPORTS", emoji:"‚öΩ"}, {en:"GYMNASTICS", img:"ü§∏", cat:"SPORTS", emoji:"‚öΩ"},
    {en:"RUNNING", img:"üèÉ", cat:"SPORTS", emoji:"‚öΩ"}, {en:"SKATEBOARDING", img:"üõπ", cat:"SPORTS", emoji:"‚öΩ"}, {en:"SWIMMING", img:"üèä", cat:"SPORTS", emoji:"‚öΩ"},
    {en:"TABLE TENNIS", img:"üèì", cat:"SPORTS", emoji:"‚öΩ"}, {en:"YOGA", img:"üßò", cat:"SPORTS", emoji:"‚öΩ"},

    {en:"CARTOON", img:"cartoon.png", isImage:true, cat:"TV", emoji:"üì∫"}, {en:"COOKERY PROGRAMME", img:"cookery programme.png", isImage:true, cat:"TV", emoji:"üì∫"},
    {en:"DOCUMENTARY", img:"documentary.png", isImage:true, cat:"TV", emoji:"üì∫"}, {en:"FILM", img:"film.png", isImage:true, cat:"TV", emoji:"üì∫"},
    {en:"MUSIC PROGRAMME", img:"music programme.png", isImage:true, cat:"TV", emoji:"üì∫"}, {en:"QUIZ SHOW", img:"quiz show.png", isImage:true, cat:"TV", emoji:"üì∫"},
    {en:"TALENT SHOW", img:"talent show.png", isImage:true, cat:"TV", emoji:"üì∫"}, {en:"THE NEWS", img:"the news.png", isImage:true, cat:"TV", emoji:"üì∫"},

    {en:"ARCHITECT", img:"architect.png", isImage:true, cat:"JOBS", emoji:"üë®‚Äçüíº"}, {en:"BUILDER", img:"üë∑", cat:"JOBS", emoji:"üë®‚Äçüíº"},
    {en:"FARMER", img:"üë®‚Äçüåæ", cat:"JOBS", emoji:"üë®‚Äçüíº"}, {en:"FIREFIGHTER", img:"üë®‚Äçüöí", cat:"JOBS", emoji:"üë®‚Äçüíº"},
    {en:"NURSE", img:"nurse.png", isImage:true, cat:"JOBS", emoji:"üë®‚Äçüíº"}, {en:"PILOT", img:"üë©‚Äç‚úàÔ∏è", cat:"JOBS", emoji:"üë®‚Äçüíº"},
    {en:"SINGER", img:"singer.png", isImage:true, cat:"JOBS", emoji:"üë®‚Äçüíº"}, {en:"VET", img:"vet.png", isImage:true, cat:"JOBS", emoji:"üë®‚Äçüíº"},
    {en:"TEACHER", img:"üë©‚Äçüè´", cat:"JOBS", emoji:"üë®‚Äçüíº"}, {en:"DOCTOR", img:"üë©‚Äç‚öïÔ∏è", cat:"JOBS", emoji:"üë®‚Äçüíº"},
    {en:"TAXI DRIVER", img:"taxi driver.png", isImage:true, cat:"JOBS", emoji:"üë®‚Äçüíº"}, {en:"TENNIS PLAYER", img:"tennis player.png", isImage:true, cat:"JOBS", emoji:"üë®‚Äçüíº"},
    {en:"DANCER", img:"dancer.png", isImage:true, cat:"JOBS", emoji:"üë®‚Äçüíº"},

    {en:"BAKERS", img:"bakers.png", isImage:true, cat:"SHOPS", emoji:"üõçÔ∏è"}, {en:"BOOKSHOP", img:"bookshop.png", isImage:true, cat:"SHOPS", emoji:"üõçÔ∏è"},
    {en:"CAF√â", img:"cafe.png", isImage:true, cat:"SHOPS", emoji:"üõçÔ∏è"}, {en:"CLOTHES SHOP", img:"clothes shop.png", isImage:true, cat:"SHOPS", emoji:"üõçÔ∏è"},
    {en:"DEPARTMENT STORE", img:"department store.png", isImage:true, cat:"SHOPS", emoji:"üõçÔ∏è"}, {en:"GREENGROCERS", img:"greengrocers.png", isImage:true, cat:"SHOPS", emoji:"üõçÔ∏è"},
    {en:"NEWSAGENTS", img:"newsagents.png", isImage:true, cat:"SHOPS", emoji:"üõçÔ∏è"}, {en:"SUPERMARKET", img:"supermarket.png", isImage:true, cat:"SHOPS", emoji:"üõçÔ∏è"},
    {en:"TOY SHOP", img:"toy shop.png", isImage:true, cat:"SHOPS", emoji:"üõçÔ∏è"}, {en:"SHOE SHOP", img:"shoe shop.png", isImage:true, cat:"SHOPS", emoji:"üõçÔ∏è"},
    {en:"EURO", img:"üí∂", cat:"SHOPS", emoji:"üõçÔ∏è"}, {en:"POUND", img:"üí∑", cat:"SHOPS", emoji:"üõçÔ∏è"}, {en:"DOLLAR", img:"üíµ", cat:"SHOPS", emoji:"üõçÔ∏è"},

    {en:"BEARD", img:"beard.png", isImage:true, cat:"APPEARANCE", emoji:"üßë"}, {en:"CURLY HAIR", img:"curly hair.png", isImage:true, cat:"APPEARANCE", emoji:"üßë"},
    {en:"DARK HAIR", img:"dark hair.png", isImage:true, cat:"APPEARANCE", emoji:"üßë"}, {en:"FAIR HAIR", img:"fair hair.png", isImage:true, cat:"APPEARANCE", emoji:"üßë"},
    {en:"FRECKLES", img:"freckles.png", isImage:true, cat:"APPEARANCE", emoji:"üßë"}, {en:"GLASSES", img:"glasses.png", isImage:true, cat:"APPEARANCE", emoji:"üßë"},
    {en:"MOUSTACHE", img:"moustache.png", isImage:true, cat:"APPEARANCE", emoji:"üßë"}, {en:"STRAIGHT HAIR", img:"straight hair.png", isImage:true, cat:"APPEARANCE", emoji:"üßë"},
    {en:"TALL", img:"tall.png", isImage:true, cat:"APPEARANCE", emoji:"üßë"}, {en:"SHORT", img:"short.png", isImage:true, cat:"APPEARANCE", emoji:"üßë"},
    {en:"OLD", img:"old.png", isImage:true, cat:"APPEARANCE", emoji:"üßë"}, {en:"YOUNG", img:"young.png", isImage:true, cat:"APPEARANCE", emoji:"üßë"},
    {en:"THIN", img:"thin.png", isImage:true, cat:"APPEARANCE", emoji:"üßë"}, {en:"FAT", img:"fat.png", isImage:true, cat:"APPEARANCE", emoji:"üßë"},
    {en:"WOMAN", img:"woman.png", isImage:true, cat:"APPEARANCE", emoji:"üßë"}, {en:"MAN", img:"man.png", isImage:true, cat:"APPEARANCE", emoji:"üßë"},
    {en:"BOY", img:"boy.png", isImage:true, cat:"APPEARANCE", emoji:"üßë"}, {en:"GIRL", img:"girl.png", isImage:true, cat:"APPEARANCE", emoji:"üßë"},

    {en:"AQUARIUM", img:"üêü", cat:"PLACES", emoji:"üìç"}, {en:"ART GALLERY", img:"üñºÔ∏è", cat:"PLACES", emoji:"üìç"},
    {en:"CASTLE", img:"üè∞", cat:"PLACES", emoji:"üìç"}, {en:"CITY FARM", img:"üöú", cat:"PLACES", emoji:"üìç"},
    {en:"FUNFAIR", img:"üé°", cat:"PLACES", emoji:"üìç"}, {en:"STADIUM", img:"üèüÔ∏è", cat:"PLACES", emoji:"üìç"},
    {en:"THEATRE", img:"üé≠", cat:"PLACES", emoji:"üìç"}, {en:"WATER PARK", img:"üåä", cat:"PLACES", emoji:"üìç"},
    {en:"CINEMA", img:"üé¨", cat:"PLACES", emoji:"üìç"}, {en:"FIRE STATION", img:"üöí", cat:"PLACES", emoji:"üìç"},
    {en:"MUSEUM", img:"üèõÔ∏è", cat:"PLACES", emoji:"üìç"}, {en:"HOSPITAL", img:"üè•", cat:"PLACES", emoji:"üìç"},
    {en:"POST OFFICE", img:"üìÆ", cat:"PLACES", emoji:"üìç"}, {en:"SHOPPING CENTRE", img:"üõçÔ∏è", cat:"PLACES", emoji:"üìç"},
    {en:"SWIMMING POOL", img:"üèä", cat:"PLACES", emoji:"üìç"}, {en:"TRAIN STATION", img:"üöâ", cat:"PLACES", emoji:"üìç"},
    {en:"ZOO", img:"ü¶Å", cat:"PLACES", emoji:"üìç"}, {en:"SCHOOL", img:"üè´", cat:"PLACES", emoji:"üìç"},
    {en:"SUPERMARKET", img:"üõí", cat:"PLACES", emoji:"üìç"}, {en:"HOTEL", img:"üè®", cat:"PLACES", emoji:"üìç"},
    {en:"BEACH", img:"üèñÔ∏è", cat:"PLACES", emoji:"üìç"}, {en:"PARK", img:"üå≥", cat:"PLACES", emoji:"üìç"},
    {en:"LIBRARY", img:"üìö", cat:"PLACES", emoji:"üìç"}
];

/* --- L√ìGICA ULTRA --- */
let currentList = [], currentIndex = 0, isFlipped = false, errorList = [];
let gameMode = 'IMG-EN', isExamMode = false;
let seconds = 0, timerInterval = null, correct = 0, wrong = 0, currentStreak = 0;

const ui = {
    card: document.getElementById("flashcard"),
    faceFront: document.getElementById("faceFront"), faceBack: document.getElementById("faceBack"),
    textFront: document.getElementById("textFront"), textBack: document.getElementById("textBack"),
    imgFront: document.getElementById("imgFront"), imgBack: document.getElementById("imgBack"),
    flagFront: document.getElementById("flagFront"), flagBack: document.getElementById("flagBack"),
    counter: document.getElementById("counterDisplay"),
    prevBtn: document.getElementById("prevBtn"), nextBtn: document.getElementById("nextBtn"),
    catSelect: document.getElementById("categorySelect"),
    examBar: document.getElementById("examBar"),
    timer: document.getElementById("timer"), streak: document.getElementById("streak"),
    scoreCorrect: document.getElementById("scoreCorrect"), scoreWrong: document.getElementById("scoreWrong"),
    examActions: document.getElementById("examActions"), soundBtn: document.getElementById("soundBtn"),
    mixPanel: document.getElementById("mixPanel"), mixCheckboxes: document.getElementById("mixCheckboxes"),
    progressBar: document.getElementById("progressBar")
};

const categoryOrder = [
    { name: "CALENDAR", emoji: "üìÖ" }, { name: "NUMBERS", emoji: "üî¢" }, { name: "SPORTS", emoji: "‚öΩ" }, 
    { name: "TV", emoji: "üì∫" }, { name: "JOBS", emoji: "üë®‚Äçüíº" }, { name: "SHOPS", emoji: "üõçÔ∏è" }, 
    { name: "APPEARANCE", emoji: "üßë" }, { name: "PLACES", emoji: "üìç" }
];

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playBeep(freq, dur) {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = "sine"; osc.frequency.value = freq;
    gain.gain.setValueAtTime(0.08, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.start(); osc.stop(audioCtx.currentTime + dur);
}

function initCategories() {
    categoryOrder.forEach(cat => {
        const opt = document.createElement("option");
        opt.value = cat.name; opt.textContent = `${cat.emoji} ${cat.name}`;
        ui.catSelect.appendChild(opt);
        ui.mixCheckboxes.innerHTML += `<div><input type="checkbox" value="${cat.name}" id="cb_${cat.name}"> <label for="cb_${cat.name}">${cat.emoji} ${cat.name}</label></div>`;
    });
}

function setMode(mode) {
    gameMode = mode;
    document.getElementById("btnImgEn").classList.toggle("active", mode === 'IMG-EN');
    document.getElementById("btnEnImg").classList.toggle("active", mode === 'EN-IMG');
    ui.progressBar.style.background = mode === 'IMG-EN' ? 'var(--color-img-mode)' : 'var(--color-word-mode)';
    resetCardFace(); updateUI();
}

function toggleExamMode() {
    isExamMode = !isExamMode;
    document.getElementById("btnExam").classList.toggle("active", isExamMode);
    ui.examBar.style.display = isExamMode ? "flex" : "none";
    ui.examActions.style.display = isExamMode ? "flex" : "none";
    ui.soundBtn.style.display = isExamMode ? "none" : "block";
    if(isExamMode) startExam(); else resetExam();
}

function startExam() {
    resetExam();
    timerInterval = setInterval(() => {
        seconds++;
        ui.timer.textContent = `${String(Math.floor(seconds/60)).padStart(2,'0')}:${String(seconds%60).padStart(2,'0')}`;
    }, 1000);
    changeCategory();
}

function resetExam() {
    clearInterval(timerInterval); seconds = 0; correct = 0; wrong = 0; currentStreak = 0; errorList = [];
    ui.timer.textContent = "00:00"; ui.scoreCorrect.textContent = "0"; ui.scoreWrong.textContent = "0"; ui.streak.textContent = "0";
}

function markResult(isCorrect) {
    if(isCorrect) { correct++; currentStreak++; playBeep(880, 0.15); } 
    else { wrong++; currentStreak = 0; errorList.push(currentList[currentIndex]); playBeep(220, 0.3); }
    ui.scoreCorrect.textContent = correct; ui.scoreWrong.textContent = wrong; ui.streak.textContent = currentStreak;
    if(currentIndex === currentList.length - 1) {
        clearInterval(timerInterval);
        if(errorList.length > 0 && confirm("Finish! Try mistakes again?")) {
            currentList = [...errorList]; errorList = []; currentIndex = 0; resetCardFace(); updateUI();
        } else toggleExamMode();
    } else nextCard();
}

function handleCategoryChange() {
    ui.mixPanel.style.display = (ui.catSelect.value === "MIXED") ? "block" : "none";
    if(ui.catSelect.value !== "MIXED") changeCategory();
}

function changeCategory() {
    const val = ui.catSelect.value;
    let selectedCats = [];
    if(val === "ALL") selectedCats = categoryOrder.map(c => c.name);
    else if (val === "MIXED") {
        selectedCats = Array.from(ui.mixCheckboxes.querySelectorAll('input:checked')).map(cb => cb.value);
        if(selectedCats.length === 0) return;
        ui.mixPanel.style.display = "none";
    } else selectedCats = [val];

    currentList = vocab.filter(item => selectedCats.includes(item.cat)).sort(() => Math.random() - 0.5);
    currentIndex = 0; resetCardFace(); updateUI();
}

function updateUI() {
    if(currentList.length === 0) return;
    const item = currentList[currentIndex];
    const isImgEn = gameMode === 'IMG-EN';

    ui.imgFront.innerHTML = ""; ui.textFront.textContent = ""; ui.flagFront.style.display = "none";
    ui.imgBack.innerHTML = ""; ui.textBack.textContent = ""; ui.flagBack.style.display = "none";

    if (isImgEn) {
        ui.faceFront.className = 'card-face front face-img';
        item.isImage ? ui.imgFront.innerHTML = `<img src="${item.img}">` : ui.imgFront.innerHTML = item.img;
        ui.faceBack.className = 'card-face back face-word';
        ui.textBack.textContent = item.en;
        ui.flagBack.style.display = "block";
    } else {
        ui.faceFront.className = 'card-face front face-word';
        ui.textFront.textContent = item.en;
        ui.flagFront.style.display = "block";
        ui.faceBack.className = 'card-face back face-img';
        item.isImage ? ui.imgBack.innerHTML = `<img src="${item.img}">` : ui.imgBack.innerHTML = item.img;
    }

    ui.counter.textContent = `${currentIndex + 1} / ${currentList.length}`;
    ui.progressBar.style.width = `${((currentIndex + 1) / currentList.length) * 100}%`;
    ui.prevBtn.disabled = (currentIndex === 0);
    ui.nextBtn.disabled = (currentIndex === currentList.length - 1);
}

function flipCard() { 
    isFlipped = !isFlipped; 
    ui.card.classList.toggle("is-flipped", isFlipped); 
    // Audio habilitado para todos los modos cuando se da la vuelta
    if(isFlipped) setTimeout(playCurrentAudio, 200); 
}

function resetCardFace() { isFlipped = false; ui.card.classList.remove("is-flipped"); }
function nextCard() { if(currentIndex < currentList.length - 1) { currentIndex++; resetCardFace(); setTimeout(updateUI, 150); } }
function prevCard() { if(currentIndex > 0) { currentIndex--; resetCardFace(); setTimeout(updateUI, 150); } }

function playCurrentAudio() {
    window.speechSynthesis.cancel();
    const utterance = new SpeechSynthesisUtterance(currentList[currentIndex].en);
    utterance.lang = "en-GB"; utterance.rate = 0.9;
    window.speechSynthesis.speak(utterance);
}

initCategories();
changeCategory();
setMode('IMG-EN');
</script>
</body>
</html>